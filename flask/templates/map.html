<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Yazaki Map</title>
        <meta
            name="viewport"
            content="initial-scale=1,maximum-scale=1,user-scalable=no"
        />
        <link
            href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css"
            rel="stylesheet"
        />
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
        <link rel="stylesheet" href="{{ css }}">

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"
        ></script>
    </head>
    <body>
        <div class="navbar">
            <ul class="nav">
                <li class="nav-item">
                    <a class="nav-link active" href="#">Home</a>
                </li>   
                <li class="nav-item">
                    <a class="nav-link active" href="#">Map</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="#">File Upload</a>
                </li>
            </ul>
        </div>

    <div class="sidebar">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link">Plant Capability</a>
            </li>
            <li class="nav-item">
                <a class="nav-link">Country</a>
            </li>
            <li class="nav-item">
                <a class="nav-link">Logistics</a>
            </li>
            <li class="nav-item">
                <a class="nav-link">Plant Availability</a>
            </li>
        </ul>
    </div>

    <div id="map"></div>
    <script>
        async function getJSON(url) {
            const response = await fetch(url);
            const data = await response.json();
            console.log(typeof data);
            console.log(data);
            return data;
        }
        mapboxgl.accessToken =
          "pk.eyJ1IjoidGN1cnRpczIwMDEiLCJhIjoiY2xmNGIxbnZ3MDB4NjN5bzl5dXFheHhsbSJ9.tYigyctoEj13PPZwSQfGig";
        const map = new mapboxgl.Map({
            container: "map", // container ID
            // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
            style: "mapbox://styles/mapbox/dark-v11", // style URL
            center: [-74.5, 40], // starting position [lng, lat]
            zoom: 9, // starting zoom
            projection: "mercator",
        });
        map.on('load', () => {
            map.addSource('availability', {
                type: 'geojson',
                data: '../static/data.geojson'
            });
            
            map.addLayer(
                {
                    id: 'availability-heat',
                    type: 'heatmap',
                    source: 'availability',
                    maxzoom: 15,
                    paint: {
                        'heatmap-weight' : {
                            property: 'availability',
                            type: 'exponential',
                            stops: [
                                [0, 0],
                                [1, 1]
                            ]
                        },
                        'heatmap-intensity' : {
                            stops: [
                                [11, 1],
                                [15, 3]
                            ]
                        },
                        'heatmap-color' : [
                            'interpolate',
                            ['linear'],
                            ['heatmap-density'],
                            0, 'rgba(33,102,172,0)',
                            0.2, 'rgb(103,169,207)',
                            0.4, 'rgb(209,229,240)',
                            0.6, 'rgb(253,219,199)',
                            0.8, 'rgb(239,138,98)',
                            1, 'rgb(178,24,43)'

                        ],
                        'heatmap-radius' : {
                            stops: [
                                [11, 15],
                                [15, 20]
                            ]
                        },
                        'heatmap-opacity' : {
                            default: 1,
                            stops: [
                                [14, 1],
                                [15, 0]
                            ]
                        },
                    }
                }
                
            );

            map.addLayer(
  {
    id: 'availability-point',
    type: 'circle',
    source: 'availability',
    minzoom: 14,
    paint: {
      // increase the radius of the circle as the zoom level and dbh value increases
      'circle-radius': {
        property: 'availability',
        type: 'exponential',
        stops: [
          [{ zoom: 15, value: 1 }, 5],
          [{ zoom: 15, value: 62 }, 10],
          [{ zoom: 22, value: 1 }, 20],
          [{ zoom: 22, value: 62 }, 50]
        ]
      },
      'circle-color': {
        property: 'availability',
        type: 'exponential',
        stops: [
          [0, 'rgba(236,222,239,0)'],
          [10, 'rgb(236,222,239)'],
          [20, 'rgb(208,209,230)'],
          [30, 'rgb(166,189,219)'],
          [40, 'rgb(103,169,207)'],
          [50, 'rgb(28,144,153)'],
          [60, 'rgb(1,108,89)']
        ]
      },
      'circle-stroke-color': 'white',
      'circle-stroke-width': 1,
      'circle-opacity': {
        stops: [
          [14, 0],
          [15, 1]
        ]
      }
    }
  },
  'availability-heat'
);


        });
    </script>
  </body>
</html>
